<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Annual Mass Shooting Data</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>

<body>
  <div class="page-shell">
    <header class="hero">
      <p class="eyebrow">Real-time snapshot</p>
      <h1>U.S. mass shootings in <span id="current-year">—</span></h1>
      <p class="lede">Live totals compiled from massshootingtracker.site and refreshed when you load this page.</p>
    </header>

    <main class="stats-card" aria-live="polite">
      <div class="stat">
        <p class="label">Total incidents this year</p>
        <p id="how-many-shootings" class="value">Loading…</p>
      </div>
      <div class="stat">
        <p class="label">Day of the year</p>
        <p id="DOY" class="value">—</p>
      </div>
      <div class="stat">
        <p class="label">Average per day</p>
        <p id="average-shootings-per-day" class="value">—</p>
      </div>
      <p id="meta" class="meta">Calculating…</p>
    </main>

    <footer class="footnotes">
      <p>Data source: <a href="https://massshootingtracker.site/" target="_blank" rel="noopener">massshootingtracker.site</a></p>
      <p class="credit">Built to surface the scale of gun violence in near real time.</p>
      <noscript>Please enable JavaScript to load the latest counts.</noscript>
    </footer>
  </div>

  <script type="module">
    const currentYearEl = document.getElementById('current-year');
    const totalEl = document.getElementById('how-many-shootings');
    const doyEl = document.getElementById('DOY');
    const avgEl = document.getElementById('average-shootings-per-day');
    const metaEl = document.getElementById('meta');

    const today = new Date();
    const year = today.getFullYear();
    currentYearEl.textContent = year;

    const dayOfYear = (() => {
      const start = new Date(year, 0, 0);
      const diff = today - start;
      return Math.floor(diff / 86400000);
    })();
    doyEl.textContent = dayOfYear.toString();

    const numberFormatter = new Intl.NumberFormat('en-US');
    const metaTimeFormatter = new Intl.DateTimeFormat('en-US', {
      dateStyle: 'medium',
      timeStyle: 'short'
    });

    async function fetchShootings() {
      const url = `https://mass-shooting-tracker-data.s3.us-east-2.amazonaws.com/${year}-data.json`;
      try {
        const response = await fetch(url, { cache: 'no-store' });
        if (!response.ok) throw new Error(`HTTP ${response.status}`);
        const shootings = await response.json();
        return shootings.length;
      } catch (err) {
        console.error('Failed to load shooting data', err);
        throw err;
      }
    }

    (async () => {
      try {
        const count = await fetchShootings();
        totalEl.textContent = numberFormatter.format(count);
        const avg = count / dayOfYear;
        avgEl.textContent = isFinite(avg) ? avg.toPrecision(3) : '—';
        metaEl.textContent = `Updated ${metaTimeFormatter.format(new Date())}`;
      } catch (error) {
        totalEl.textContent = 'Unavailable';
        avgEl.textContent = 'Unavailable';
        metaEl.textContent = 'Could not load data. Please refresh to try again.';
      }
    })();
  </script>
  <!-- Credit for the shooting data goes to massshootingtracker.site -->
</body>

</html>
